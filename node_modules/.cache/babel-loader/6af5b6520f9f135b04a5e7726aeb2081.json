{"ast":null,"code":"import _regeneratorRuntime from\"/home/sisagricola/Documents/Software/AdmTareas/mern/FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"/home/sisagricola/Documents/Software/AdmTareas/mern/FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"/home/sisagricola/Documents/Software/AdmTareas/mern/FrontEnd/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useReducer}from'react';import AuthReducer from'./authReducer';import AuthContext from'./authContext';import clienteAxios from'../../config/axios';import tokenAuth from'../../config/token';import{REGISTRO_EXITOSO,REGISTRO_ERROR,OBTENER_USUARIO,LOGIN_EXITOSO,LOGIN_ERROR,CERRAR_SESION}from'../../types';var AuthState=function AuthState(props){var initialState={token:localStorage.getItem(\"token\"),autenticado:null,usuario:null,mensaje:null,cargando:true};var _useReducer=useReducer(AuthReducer,initialState),_useReducer2=_slicedToArray(_useReducer,2),state=_useReducer2[0],dispatch=_useReducer2[1];var registrarUsuario=/*#__PURE__*/function(){var _ref=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return clienteAxios.post(\"/api/usuarios\",datos);case 3:respuesta=_context.sent;console.log(respuesta);dispatch({type:REGISTRO_EXITOSO,payload:respuesta.data});usuarioAutenticado();_context.next=14;break;case 9:_context.prev=9;_context.t0=_context[\"catch\"](0);console.log(_context.t0.response.data.msg);alerta={msg:_context.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:REGISTRO_ERROR,payload:alerta});case 14:case\"end\":return _context.stop();}}},_callee,null,[[0,9]]);}));return function registrarUsuario(_x){return _ref.apply(this,arguments);};}();var usuarioAutenticado=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var token,respuesta;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:token=localStorage.getItem('token');if(token){tokenAuth(token);}_context2.prev=2;_context2.next=5;return clienteAxios.get('api/auth');case 5:respuesta=_context2.sent;dispatch({type:OBTENER_USUARIO,payload:respuesta.data.usuario});_context2.next=13;break;case 9:_context2.prev=9;_context2.t0=_context2[\"catch\"](2);console.log(_context2.t0.response);dispatch({type:LOGIN_ERROR});case 13:case\"end\":return _context2.stop();}}},_callee2,null,[[2,9]]);}));return function usuarioAutenticado(){return _ref2.apply(this,arguments);};}();var iniciarSesion=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee3(datos){var respuesta,alerta;return _regeneratorRuntime.wrap(function _callee3$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.prev=0;_context3.next=3;return clienteAxios.post('/api/auth',datos);case 3:respuesta=_context3.sent;dispatch({type:LOGIN_EXITOSO,payload:respuesta.data});usuarioAutenticado();console.log(respuesta);_context3.next=14;break;case 9:_context3.prev=9;_context3.t0=_context3[\"catch\"](0);console.log(_context3.t0);alerta={msg:_context3.t0.response.data.msg,categoria:\"alerta-error\"};dispatch({type:LOGIN_ERROR,payload:alerta});case 14:case\"end\":return _context3.stop();}}},_callee3,null,[[0,9]]);}));return function iniciarSesion(_x2){return _ref3.apply(this,arguments);};}();var cerrarSesion=function cerrarSesion(){dispatch({type:CERRAR_SESION});};return/*#__PURE__*/React.createElement(AuthContext.Provider,{value:{token:state.token,autenticado:state.autenticado,usuario:state.usuario,mensaje:state.mensaje,cargando:state.cargando,registrarUsuario:registrarUsuario,iniciarSesion:iniciarSesion,usuarioAutenticado:usuarioAutenticado,cerrarSesion:cerrarSesion}},props.children);};export default AuthState;","map":{"version":3,"sources":["/home/sisagricola/Documents/Software/AdmTareas/mern/FrontEnd/src/context/autentication/authState.js"],"names":["React","useReducer","AuthReducer","AuthContext","clienteAxios","tokenAuth","REGISTRO_EXITOSO","REGISTRO_ERROR","OBTENER_USUARIO","LOGIN_EXITOSO","LOGIN_ERROR","CERRAR_SESION","AuthState","props","initialState","token","localStorage","getItem","autenticado","usuario","mensaje","cargando","state","dispatch","registrarUsuario","datos","post","respuesta","console","log","type","payload","data","usuarioAutenticado","response","msg","alerta","categoria","get","iniciarSesion","cerrarSesion","children"],"mappings":"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","sourcesContent":["import React, { useReducer } from 'react';\nimport AuthReducer from './authReducer';\nimport AuthContext from './authContext';\nimport clienteAxios from '../../config/axios';\nimport tokenAuth from '../../config/token';\n\nimport { REGISTRO_EXITOSO, REGISTRO_ERROR, OBTENER_USUARIO, LOGIN_EXITOSO, LOGIN_ERROR, CERRAR_SESION } from '../../types'\n\n\nconst AuthState = props => {\n\n    const initialState = {\n        token: localStorage.getItem(`token`),\n        autenticado: null,\n        usuario: null,\n        mensaje:null,\n        cargando: true\n    };\n\n    const [state, dispatch] = useReducer(AuthReducer, initialState);\n\n    const registrarUsuario = async datos =>{\n\n        try {\n\n            const respuesta = await clienteAxios.post(`/api/usuarios`,datos);\n            console.log(respuesta);\n\n            dispatch({\n                type: REGISTRO_EXITOSO,\n                payload:respuesta.data\n            });\n\n            usuarioAutenticado();\n            \n        } catch (error) {\n            console.log(error.response.data.msg);\n\n            const alerta={\n                msg:error.response.data.msg,\n                categoria: `alerta-error`   \n            }\n\n            dispatch({\n                type: REGISTRO_ERROR,\n                payload:alerta\n            });\n        }\n    }\n\n    const usuarioAutenticado = async () => {\n\n        const token = localStorage.getItem('token');\n\n        if(token){\n            tokenAuth(token);\n        }\n\n        try {\n\n            const respuesta = await clienteAxios.get('api/auth');\n            \n            dispatch({\n                type: OBTENER_USUARIO,\n                payload:respuesta.data.usuario\n            });\n            \n        } catch (error) {\n            console.log(error.response);\n            dispatch({\n                type: LOGIN_ERROR\n            });\n        }\n    }\n\n    const iniciarSesion = async datos => {\n\n        try {\n            \n            const respuesta = await clienteAxios.post('/api/auth', datos);\n\n            dispatch({\n                type: LOGIN_EXITOSO,\n                payload: respuesta.data\n            });\n\n            usuarioAutenticado();\n            \n            console.log(respuesta);\n            \n        } catch (error) {\n            \n            console.log(error);\n            \n            const alerta={\n                msg:error.response.data.msg,\n                categoria: `alerta-error`   \n            }\n\n            dispatch({\n                type: LOGIN_ERROR,\n                payload:alerta\n            });\n            \n        }\n    }\n\n    const cerrarSesion = () =>{\n\n        dispatch({\n            type: CERRAR_SESION\n        });\n    }\n\n    return (\n        <AuthContext.Provider\n\n            value={{\n                token: state.token,\n                autenticado: state.autenticado,\n                usuario: state.usuario,\n                mensaje: state.mensaje,\n                cargando: state.cargando,\n                registrarUsuario,\n                iniciarSesion,\n                usuarioAutenticado,\n                cerrarSesion\n            }}\n        >\n            {props.children}\n        </AuthContext.Provider>\n    )\n}\n\nexport default AuthState;"]},"metadata":{},"sourceType":"module"}